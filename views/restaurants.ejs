<!DOCTYPE html>
<html>
    <head>
        <% const title = global.primary_routes_title[page]%>
        <% include ../views/templates/head %>
        <script src="/javascripts/search.js"></script>
        <script src="/javascripts/map.js"></script>
        <script>
            var cuisine_arr = <%- JSON.stringify(cuisine_arr) %>;
            $('document').ready(() => {
                setLocation();
                setCuisineSel(cuisine_arr);
                $('#locSearchToggle').click(()=>{
                    let state = ($('#locSearchToggle').attr('aria-expanded')==='true');
                    $('#locSearchToggle > span').attr('data-glyph', 'chevron-' + (state ? 'bottom' : 'top'));
                    if (!state) {
                        console.log($('.marker-count span').html(markers.length));
                    }
                });
            });
        </script>
    </head>
    <body>
        <% include ../views/templates/nav.ejs%>
        <header class="jumbotron jumbotron-fluid text-center bg-dark text-white">
            <h1><%= title %></h1>
            <input class="selectize-input searchTextBox" form="xForm" type="text" name="keywords"
                   id="keywords" placeholder="Keywords"
                   <%-(typeof keywords !== 'undefined') ? "value='" + keywords + "'" : ''%> />
            <br />
            <input form="xForm" type="text" name="cuisine" id="cuisine_selector" placeholder="Cuisine"/>
            <button id="locSearchToggle" type="button" class="btn btn-secondary btn-sm" data-toggle="collapse"
                    data-target="#locationSearch">
                Choose Location<span class="oi ml-1" data-glyph="chevron-bottom"></span></button>
            <div id="locationSearch" class="collapse">
                <input class="selectize-input searchTextBox" form="xForm" name="pac_input" id="pac-input" type="text"
                       placeholder="Enter a location" />
                <input class="selectize-input searchTextBox" form="xForm" type="number" name="radius"
                       id="radius" step="any" placeholder="Radius (km)" value="1"  min="1"/>
                <div class="pac-card" id="pac-card">
                    <div id="map"></div>
                </div>
            </div>
            <hr />
            <form id="xForm" onsubmit="onSubmit('<%- page %>', (dat) => searchFn(dat));">
                <input type="hidden" name="lat" id="lat" value="0"/>
                <input type="hidden" name="lng" id="lng" value="0"/>
            </form>
            <button form="xForm" id="g" name="g" type="submit" class="btn btn-primary">
                Search<span class="oi ml-1" data-glyph="magnifying-glass"></span></button>
        </header>
        <script src="https://maps.googleapis.com/maps/api/js?key=<%= API %>&libraries=places&callback=initMap"
                async defer></script>
        <main id="results" style="margin-top:30px">
        </main>
    </body>
</html>
